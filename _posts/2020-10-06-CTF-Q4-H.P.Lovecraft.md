---
layout: single
classes: wide
title: "CTF-Q4 - Writeup - H.P.Lovecraft"
date: 2020-10-06
header:
  teaser: /assets/images/content/CTF/Q4-2020/hplovecraft/image001.PNG
  teaser_home_page: true
categories:
  - CTF
  - Writeup
tags:
  - CTF
  - "2020"
  - "Q4"
---

Ingresamos a la direcci칩n `http://10.10.10.100` para ver qu칠 nos muestra.

Aparentemente parece ser un sitio que contiene algunos cuentos de Lovecraft en la que se nos invita a leer.

<img src="/assets/images/content/CTF/Q4-2020/hplovecraft/image002.PNG" style="zoom: 80%;" />{: .align-center}

<img src="/assets/images/content/CTF/Q4-2020/hplovecraft/image003.PNG" alt="image003" style="zoom: 80%;" />{: .align-center}

<img src="/assets/images/content/CTF/Q4-2020/hplovecraft/image004.PNG" alt="image004" style="zoom: 80%;" />{: .align-center}



Mientras revisamos con m치s detalles, dejamos corriendo un escaneo de archivos y directorios.  Para este caso utilizaremos `dirsearch` y el diccionario `big.txt`, ya que de los convencionales, es el que m치s resultados nos arroja.

```bash
$ dirsearch -u http://10.10.10.100 -e html,txt,php,aspx -f -t 10 -w /usr/share/wordlists/dirb/big.txt 

 _|. _ _  _  _  _ _|_    v0.3.8
(_||| _) (/_(_|| (_| )

Extensions: html, txt, php, aspx | HTTP method: get | Threads: 10 | Wordlist size: 102340

Target: http://10.10.10.100

[16:11:07] Starting: 
[16:11:27] 200 -  278B  - /assets/                       
[16:12:03] 200 -  393KB - /flag.txt                    
[16:12:15] 200 -  400B  - /images/              
[16:12:16] 200 -    7KB - /index.html          
[16:12:59] 200 -    4KB - /robots.txt              
                                                     
Task Completed

```



Algo nos llama la atenci칩n. "`flag.txt`"????.  As칤 de f치cil?. V치mos a ver.

<img src="/assets/images/content/CTF/Q4-2020/hplovecraft/image005.PNG" style="zoom:67%;" />{: .align-center}

Espera. En realidad es una imagen? y un QR en espec칤fico?. Veamos qu칠 trae.

<img src="/assets/images/content/CTF/Q4-2020/hplovecraft/image006.PNG" style="zoom: 80%;" />{: .align-center}



Rabbit Hole 游. Al parecer no ser치 tan f치cil c칩mo se cre칤a. Sigamos revisando los dem치s resultados. Ejemplo, el archivo `robots.txt` de vez en cuando nos entrega informaci칩n 칰til.

<img src="/assets/images/content/CTF/Q4-2020/hplovecraft/image007.PNG" style="zoom:80%;" />{: .align-center}

Creo que tampoco nos ayudar치 en esta oportunidad. Solo nos queda realizar revisiones manuales.

Veamos el c칩digo fuente del index.

![](/assets/images/content/CTF/Q4-2020/hplovecraft/image008.PNG){: .align-center}



Primera l칤nea y un mensaje comentado:

> Crees que podr치s mantener la cordura?. Recuerda que eres solo un humano y no una m치quina.

Muy caracter칤sticos de los cuentos de Lovecraft, hace alusi칩n a la "cordura". Lo tendremos en cuenta.

M치s all치 de eso, nada 칰til por el momento. Sigamos revisando ahora los cuentos.

Como dicen por ah칤 "mucho texto" y no le dan importancia a lo que est치n leyendo. Pero si nos fijamos bien, en el primer cuento "M치s all치 del muro del sue침o" tiene una trama interesante y directamente relacionada con la "cordura".

Qu칠 pasa si revisamos el c칩digo fuente?

![](/assets/images/content/CTF/Q4-2020/hplovecraft/image009.PNG){: .align-center}

> Tal vez romper las barreras te lleven a una nueva realidad.

Otro mensaje comentado. Tambi칠n haciendo alusion al cuento en particular.

A estas alturas, al parecer las revisi칩nes van por el lado del c칩digo fuente del sitio.

Si seguimos viendo bien, sobre todo en los recursos utilizados, podemos percatarnos que para el cuento "M치s all치 del muro del sue침o" , se est치 utilizando una imagen en formato `.png`. Se puede distinguir al hacer revisi칩n del c칩digo fuente de cada enlace, o bien, revisando el directorio `/images/` que nos detect칩 dirsearch.



![](/assets/images/content/CTF/Q4-2020/hplovecraft/image010.PNG){: .align-center}

![image011](/assets/images/content/CTF/Q4-2020/hplovecraft/image011.PNG){: .align-center}



Al verla, corresponde al recurso utilizado como background para el enlace del cuento.

![](/assets/images/content/CTF/Q4-2020/hplovecraft/image012.PNG){: .align-center}



La descargamos y hacemos revisi칩n m치s en profundidad sobre ella.

Todo apunta a ser un stego 游뱂 pero herramientas como steghide, stegcraker, stegpy no nos servir치 mucho que digamos. 

Para este caso, utilizaremos [openstego](https://www.openstego.com/index.html). Una herramienta desarrollada en Java, que nos permite usar tanto su interfaz gr치fica o bien, la [l칤nea de comandos](https://www.openstego.com/cmdline.html).

Los recursos puedes encontralos [ac치](https://github.com/syvaidya/openstego/releases)游녣.

Te recomiendo descargar el `openstego-0.7.*.zip`. Ya ver치s porqu칠 游땔.

Ahora para continuar, necesitamos una contrase침a, no?. Te recomiendo no perder el tiempo utilizando diccionarios convencionales como `rockyou`, `seclist`, `kaonashi`, etc. Ya que no servir치n para este desaf칤o. 

Generaremos nuestro propio diccionario con `cewl`. Una herramienta escrita en Ruby que nos permite crear diccionarios en base a un sitio web que le indiquemos.   *Qu칠 no era mucho texto lo que ten칤amos en un principio, eh?*游뗷

Para ello, usamos la sint치xis:

```bash
$ cewl http://10.10.10.100 -w diccionario.txt -v
```

Donde `-w` le indicamos el nombre con el que se guardar치 nuestro diccionario, y `-v` para verbosidad mientras se realiza el proceso (opcional).

Una vez generado nuestro diccionario, vamos a hacer uso de la herramienta openstego en su l칤nea de comandos para ver qu칠 contiene esa imagen.

Cuando descomprimamos el archivo zip que descargamos un momento atr치s, nos interesa el archivo `openstego.jar` dentro de la carpeta `openstego-0.7.*/lib/`.

Para ver el men칰 de ayuda, puedes ejecutar :

```bash
$ java -jar openstego.jar help
```

Puedes ver la documentaci칩n [ac치](https://www.openstego.com/cmdline.html)游녣.

Ya sabido esto, la sint치xis para extraer un archivo stego ser칤a:

```bash
$ java -jar openstego.jar extract -a RandomLSB -sf {ruta/archivodelstego} -xd {carpetadestino} -p {contrase침a}
```

Con peras y tolueno ser칤a:

`-a`  : algoritmo a utilizar. En openstego podemos hacer uso de `RandomLSB` (para prop칩sito de ocultar datos) y `DWTDugad` (marca de agua).

`-sf`: stegofile o archivo que posee la data oculta.

`-xd`: directorio de extracci칩n.

`-p` : contrase침a.



Ya que no nos permite hacer uso de un diccionario para la contrase침a, podemos hacer un one-liner para aprovechar esta sint치xis, lo que quedar칤a de la siguiente forma:

```bash
for contrasenna in $(cat diccionario.txt); do echo -e "[+] "$contrasenna && java -jar ~/tools/openstego/openstego-0.7.4/lib/openstego.jar extract -a RandomLSB -sf banner3.png -xd ~/. -p $contrasenna ;done;

```

Veremos que durante el proceso saldr치 un mensaje `Extracted file: {RutaDeExtracci칩n}/....txt` para la palabra `Polaris` y que se ha extraido un archivo `....txt` en la ruta que le indicamos.

Ahora nos toca revisar.

**Alerta de spoiler** : recuerda que en Linux los archivos que empiezan con `.` quedan ocultos游땔.

Hacemos un cat al archivo extra칤do y.... 

```bash
$ cat ....txt 
춺El d칤a 22 de febrero de 1901, una nueva y maravillosa estrella fue descubierta por el doctor Anderson, de Edimburgo, no lejos de Algol. Ning칰n astro era antes visible en ese lugar. En veinticuatro horas, la desconocida hab칤a alcanzado brillo suficiente como para opacar Capella. En una semana o dos hab칤a aminorado visiblemente, y con el paso de unos pocos meses apenas era visible a simple vista.췉

Q4{_R.1.p._Jo3_5l4TEr_}
```



Hemos conseguido la flag 游댠游끠

**Flag :** `Q4{_R.1.p._Jo3_5l4TEr_}`
